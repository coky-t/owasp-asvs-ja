# V16: ファイルおよびリソース検証要件

## 管理目標

検証されるアプリケーションが以下の上位レベルの要件を満たしていることを確認します。

* 信頼できないファイルのデータはそれに応じてセキュアに処理する必要があります。
* 信頼できない情報源から取得した信頼できないファイルデータはウェブルートの外部に、かつ制限されたパーミッションで保存されています。

## セキュリティ検証要件

| # | 説明 | L1 | L2 | L3 | 導入バージョン |
| --- | --- | --- | --- | -- | -- |
| **16.1** | URL リダイレクトおよびフォワードはホワイトリストに登録されている宛先のみが許可されている、または潜在的に信頼できないコンテンツにリダイレクトする場合には警告を表示していることを検証します。 | ✓ | ✓ | ✓ | 2.0 |
| **16.2** | アプリケーションに送信される信頼できないファイルデータはファイル I/O コマンドで直接使用されておらず、特にパストラバーサル、ローカルファイルインクルード、ファイル MIME タイプ、反射型ファイルダウンロード、および OS コマンドインジェクションなどの脆弱性から保護されていることを検証します。 | ✓ | ✓ | ✓ | 4.0 |
| **16.3** | 信頼できない情報源から取得したファイルは期待したタイプであることが検証されており、既知の悪意のあるコンテンツのアップロードを防ぐためにアンチウィルススキャナによりスキャンされていることを検証します。 | ✓ | ✓ | ✓ | 2.0 |
| **16.4** | 信頼できないデータはインクルード、クラスローダー、リフレクション機能内で使用されておらず、リモートおよびローカルコード実行脆弱性を防いでいることを検証します。 | ✓ | ✓ | ✓ | 4.0 |
| **16.5** | 信頼できないデータはクロスドメインリソース共有 (CORS) 内で使用されておらず、任意のリモートコンテンツから保護していることを検証します。この方法の例については [0x92-Appendix-C_CodeExamples.md](0x92-Appendix-C_CodeExamples.md) を参照してください。 | ✓ | ✓ | ✓ | 2.0 |
| **16.6** | 信頼できない情報源から取得したファイルはウェブルートの外部に保存され、パーミッションが制限されており、可能であれば強力な検証が行われていることを検証します。 |  | ✓ | ✓ | 3.0 |
| **16.7** | ウェブまたはアプリケーションサーバーはデフォルトでウェブまたはアプリケーションサーバーの外部にあるリモートリソースやシステムへのアクセスを拒否するように設定されていることを検証します。 |  | ✓ | ✓ | 2.0 |
| **16.8** | アプリケーションコードは信頼できない情報源からアップロードされたデータを実行しないことを検証します。 | ✓ | ✓ | ✓ | 3.0 |
| **16.9** | NSAPI プラグイン, Flash, Shockwave, ActiveX, Silverlight, NACL, クライアントサイドの Java アプレットなど、サポートされない、セキュアではない、推奨されないクライアントサイドのテクノロジが使用されていないことを検証します。 | ✓ | ✓ | ✓ | 4.0 |
| **16.10** | 意図しない情報やソースコードの漏洩を防ぐために、ウェブ層は特定のファイル拡張子を持つファイルのみを扱うように設定されていることを検証します。例えば、.bak, .swp などのエディタで一般的に使用されている拡張子はウェブ層で扱うべきではありません。 | ✓ | ✓ | ✓ | 4.0 |
| **16.11** | アプリケーションは大きすぎてサーバーをいっぱいにしたり、過剰なストレージコストが発生する可能性があるファイルを受け入れないことを検証します。 | ✓ | ✓ | ✓ | 4.0 |
| **16.12** | 信頼できないアップロードされた HTML および SVG ファイルは text/plain または直接ダウンロードとしてのみ返され、text/html としては返されないこと、またはアップロードされたファイルが XSS 攻撃を仕掛けるために使用されないように別のサブドメインが使用されることを検証します。 | ✓ | ✓ | ✓ | 4.0 |
| **16.13** | 一人のユーザーが多すぎるファイルでサーバーをいっぱいにすることができないように、一人のユーザーあたりのファイルサイズクォータが適用されていることを検証します。 |  | ✓ | ✓ | 4.0 |
| **16.14** | 信頼できないソースから取得したファイルは、そのファイルの「マジックナンバー」や他のコンテンツに基づいて予想されるタイプであることが妥当性確認されていることを検証します。 |  | ✓ | ✓ | 4.0 |

## 参考情報

詳細については、以下も参照してください。

* [File Extension Handling for Sensitive Information](https://www.owasp.org/index.php/Unrestricted_File_Upload)
* [Reflective file download by Oren Hafif](https://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/)

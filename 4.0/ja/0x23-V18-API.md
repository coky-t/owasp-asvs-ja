# V18: API およびウェブサービス検証要件

## 管理目標

サーバーサイド API (一般的には JSON や XML や GraphQL を使用) を使用する検証されるアプリケーションは以下を有することを確認します。

* すべてのウェブサービスの適切な認証、セッション管理、認可。
* 下位から上位の信頼レベルに遷移するすべてのパラメータの入力妥当性検査。

この標準の以前の要件は API にも適用されます (アクセス制御、転送中のセキュリティなど) 。

## セキュリティ検証要件

| # | 説明 | L1 | L2 | L3 | 導入バージョン |
| --- | --- | --- | --- | -- | -- |
| **18.1** | クライアントとサーバーの間で同じエンコーディングが使用されていることを検証します。 | ✓ | ✓ | ✓ | 3.0 |
| **18.2** | REST が使用されている場合には、HTTP メソッドがユーザーまたはアクションに対して有効な選択であることを検証します。 |  | ✓ | ✓ | 4.0 |
| **18.3** | ウェブサービスアプリケーション内の管理者および管理機能へのアクセスはウェブサービス管理者に限定されていることを検証します。 | ✓ | ✓ | ✓ | 3.0 |
| **18.4** | 入力を受け入れる前に XML または JSON スキーマが配置および検証されていることを検証します。 | ✓ | ✓ | ✓ | 3.0 |
| **18.5** | SOAP ベースのウェブサービスが Web Services-Interoperability (WS-I) 基本プロファイルに最低限準拠していることを検証します。これは本質的に TLS 暗号化を意味します。 | ✓ | ✓ | ✓ | 3.0.1 |
| **18.6** | ダブルサブミットクッキーパターン、CSRF ノンス、ORIGIN リクエストヘッダチェック、リファラリクエストヘッダチェックのうち少なくとも一つ以上を使用して、REST サービスがクロスサイトリクエストフォージェリから保護されていることを検証します。 | ✓ | ✓ | ✓ | 3.0.1 |
| **18.7** | REST サービスは到着した Content-Type が application/xml や application/JSON など期待したものであることを明示的にチェックしていることを検証します。 |  | ✓ | ✓ | 3.0 |
| **18.8** | JSON Web Signing や SOAP リクエスト用の WS-Security を使用して、メッセージペイロードに署名し、クライアントとサービスの間の信頼できる転送を確保していることを検証します。 |  | ✓ | ✓ | 3.0.1 |
| **18.9** | API URL が API キー、セッショントークンなどの機密情報を開示していないことを検証します。 |  | ✓ | ✓ | 4.0 |
| **18.10** | 認可の判断はリソースレベルだけではなく、URI と リソースレベルの両方で行われることを検証します。 |  | ✓ | ✓ | 4.0 |
| **18.11** | GraphQL を使用する場合、高価でネストされたクエリの結果としての DoS を防ぐために、クエリホワイトリストや深度制限と量制限の組み合わせを使用する必要があります。より高度なシナリオでは、クエリコスト解析を使用する必要があります。 |  | ✓ | ✓ | 4.0 |
| **18.12** | GraphQL を使用する場合、認可ロジックは GraphQL レイヤではなくビジネスロジックレイヤで実装される必要があります。 |  | ✓ | ✓ | 4.0 |
| **18.13** | アクセス制御が存在しない場合、REST サービスが過剰な呼び出しの影響を受けないことを検証します。過剰な呼び出しはオーバーヘッドや CPU、帯域幅の使用量の増加につながる可能性があります。解決策としては API キー、レート制限、クォータなどの自動化防止技術を実装することが考えられます。 |  | ✓ | ✓ | 4.0 |
| **18.14** | 予期しないコンテンツタイプを含むリクエストやコンテンツタイプが欠落しているリクエストが適切なヘッダ (HTTP レスポンスステータス 406 Unacceptable または 415 Unsupported Media Type) で拒否されていることを検証します。 |  | ✓ | ✓ | 4.0 |

## 参考情報

詳細については、以下も参照してください。

* [OWASP Testing Guide 4.0: Configuration and Deployment Management Testing](https://www.owasp.org/index.php/Testing_for_configuration_management)
* [OWASP Cross-Site Request Forgery cheat sheet](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet)
* [JSON Web Tokens (and Signing)](https://jwt.io/)
* [REST Security Cheat Sheet](https://www.owasp.org/index.php/REST_Security_Cheat_Sheet)

# V8: エラー処理およびログ記録検証要件

## 管理目標

エラー処理とロギングの主な目的はユーザー、管理者、インシデントレスポンスチームに対して有用な情報を提供することです。その目的は大量のログを作成することではなく、廃棄されるノイズよりもより多くのシグナルを持つ高品質のログを作成することです。

高品質のログは機密データを含むことが多く、地域ごとのデータプライバシー法や規制に従って保護する必要があります。これには以下が含まれます。

* 特に必要がない限り機密情報を収集や記録しません。
* 記録されたすべての情報がセキュアに処理され、そのデータ分類に従って保護されていることを確認します。
* ログは永続的に保存されることはなく、可能な限り短い絶対存続時間を持つことを確認します。

国ごとに定義が異なるプライベートデータや機密データをログに含む場合、そのログはアプリケーションにより保持される最も機密性の高い情報の一つとなり、攻撃者にとってそれ自体が非常に魅力的です。

また、アプリケーションがセキュアに失敗し、エラーが不要な情報を開示しないようにすることも重要です。

## セキュリティ検証要件

### 8.1 エラーログ記録

| # | 説明 | L1 | L2 | L3 | CWE | CWSS |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **8.1.1** | アプリケーションが資格情報、セッショントークン、支払い明細をログに記録しないことを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.1.2** | アプリケーションが地域のプライバシー法や関連するセキュリティポリシーの下で定義されているような機密データをログに記録しないことを検証します。 |  | ✓ | ✓ | tbd | tbd |
| **8.1.3** | 成功および失敗した認証イベント、アクセス制御の失敗、デシリアライズの失敗および入力検証の失敗など、セキュリティに関するイベントをアプリケーションがログに記録することを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.1.4** | 各ログイベントにはイベントが発生した時のタイムラインの詳細な調査を可能にするために必要な情報が含まれていることを検証します。 |  | ✓ | ✓ | tbd | tbd |
| **8.1.5** | ログ閲覧ソフトウェアで閲覧したときに、すべてのイベントはインジェクションから保護されていることを検証します。 |  | ✓ | ✓ | tbd | tbd |
| **8.1.6** | セキュリティログは不正なアクセスや改変から保護されていることを検証します。 |  | ✓ | ✓ | tbd | tbd |
| **8.1.7** | ログインジェクションを防ぐためにアプリケーションがユーザー提供のデータを適切にエンコードすることを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.1.8** | ログは分析、検出、アラート、エスカレーションのためにリモートシステムに送信されていることを検証します。 |  |  | ✓ | tbd | tbd |
| **8.1.9** | 時刻ソースが正しい時刻とタイムゾーンに同期していることを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.1.10** | 機密セッション識別子や記憶された秘密を格納することなく、すべての認証判定がログに記録されていることを検証します。これにはセキュリティ調査に必要な関連メタデータを伴うリクエストを含む必要があります。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.1.11** | システム全体で共通のログ記録フォーマットとアプローチが使用されていることを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |

### 8.2 エラー処理

| # | 説明 | L1 | L2 | L3 | CWE | CWSS |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **8.2.1** | 予期しないエラーまたはセキュリティ上重要なエラーが発生したとき、サポート担当者が調査に使用できる一意のIDを使用して、一般的なメッセージが表示されることを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.3.2** | 予期されるエラー状態および予期しないエラー状態に対して、例外処理がコードベース全体で使用されていることを検証します。 | ✓ | ✓ | ✓ | tbd | tbd |
| **8.3.3** | 未処理の例外をすべてキャッチする「最終手段」のエラーハンドラが定義されていることを検証します。 | | ✓ | ✓ | tbd | tbd |


## 参考情報

詳細については、以下も参照してください。

* [OWASP Testing Guide 4.0 content: Testing for Error Handling](https://www.owasp.org/index.php/Testing_for_Error_Handling)

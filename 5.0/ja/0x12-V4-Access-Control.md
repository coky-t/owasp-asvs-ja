# V4 アクセス制御

## 管理目標

認可とはリソースの使用を許可された人にのみアクセスを許可するという概念です。検証対象のアプリケーションが以下の上位要件を満たすことを確認します。

* リソースにアクセスする人はそうするために有効なクレデンシャルを保持しています。
* ユーザは明確に定義された一連のエンタイトルメントに関連付けられています。
* アクセス制御ポリシーのメタデータはリプレイや改竄から保護されています。

## V4.1 一般的なアクセス制御設計

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **4.1.1** | [修正] アプリケーションは信頼できるサービス層でアクセス制御規則を適用しており、クライアント側の JavaScript など信頼できないユーザーが操作できるコントロールに依存していない。 | ✓ | ✓ | ✓ | 602 |
| **4.1.2** | [修正] 明示的に認可されていない限り、エンドユーザがユーザロール、パーミッション、機能アクセスレベルなどのアクセス制御ポリシーを変更できないようにする特定の制御が存在する。 | ✓ | ✓ | ✓ | 639 |
| **4.1.3** | 最小特権の原則が存在する。ユーザは特定の権限を持つ機能、データファイル、URL、コントローラ、サービス、およびその他のリソースにのみアクセスできるようにすべきである。これはなりすましや権限昇格に対する保護を意味する。 ([C7](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 285 |
| **4.1.4** | [削除, 4.1.3 と重複] | | | | |
| **4.1.5** | [文法] 例外が発生した場合も含めて、アクセス制御がアクセスを拒否することでセキュアに失敗する。 ([C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 285 |

## V4.2 操作レベルのアクセス制御

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **4.2.1** | 機密データおよび API が、他人のレコードの作成や更新、全員のレコードの閲覧、すべてのレコードの削除など、レコードの作成、読み取り、更新、削除を目的とする非セキュア直接オブジェクト参照 (Insecure Direct Object Reference, IDOR) 攻撃に対して保護されている。 | ✓ | ✓ | ✓ | 639 |
| **4.2.2** | [修正, 13.2.3 からマージ] アプリケーションがクロスサイトリクエストフォージェリ (CSRF) 攻撃を防御し、認証された機能や機密性の高い公開機能を保護するために、開発フレームワークに組み込まれた CSRF 対策機能や CSRF トークンに加えて多層防御を使用している。 | ✓ | ✓ | ✓ | 352 |
| **4.2.3** | [追加] メッセージの発信元が信頼できない場合、またはメッセージの構文が無効な場合は、postMessage インタフェースで受信したメッセージが破棄される。 | | ✓ | ✓ | 346 |

## V4.3 その他のアクセス制御に関する考慮事項

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **4.3.1** | [修正] 管理インタフェースは信頼できるエンドポイントまたは場所からのみ論理的にアクセスできる。例えば、要塞ホストやジャンプホスト、信頼できる管理ワークステーションやエンドポイント (デバイス認証など) 、管理 LAN などへのアクセスを制限している。 | ✓ | ✓ | ✓ | 419 |
| **4.3.2** | [14.3.4, 14.3.5 へ分割] | | | | |
| **4.3.3** | [文法] アプリケーションには低価値システムに対する追加の認証 (ステップアップ認証や適応認証) がある、または代わりに、アプリケーションのリスクと過去の不正行為により不正対策制御を実施するために、高価値アプリケーションに対する役割の分離がある。 | | ✓ | ✓ | 732 |

## 参考情報

詳しくは以下の情報を参照してください。

* [OWASP Testing Guide 4.0: Authorization](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/05-Authorization_Testing/README.html)
* [OWASP Cheat Sheet: Access Control](https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html)
* [OWASP CSRF Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
* [OWASP REST Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html)

# V10 悪意あるコードおよび安全でないコード

## 管理目標

コードが以下の上位要件を満たすことを確認します。

* 悪意のある行為はアプリケーションの他の部分に影響を与えないようセキュアかつ適切に処理されます。
* 時限爆弾や他の時間ベースの攻撃を持ちません。
* 悪意のある宛先や認証されていない宛先に "Phone Home" していません。
* バックドア、イースターエッグ、サラミ攻撃、ルートキット、または攻撃者がコントロールできる不正なコードを持ちません。

悪意のあるコードを見つけることは否定命題の証明であり、完全に確認することは不可能です。コードに固有の悪意のあるコードや不要な機能が含まれていないことを確認するために、最善の努力を払うべきです。

## V10.1 コード完全性

悪意のあるコードに対する最善の防御は「信頼するが検証する」です。不正なコードや悪意のあるコードをコードに取り込むことは多くの法的管轄で犯罪行為となります。方針と手続きにより悪意のあるコードに関する制裁措置が明確になるでしょう。

開発リーダーは定期的にコードチェックインを確認すべきです。特に時刻、I/O、ネットワーク機能にアクセスする可能性を確認します。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.1.1** | [削除, スコープ外] | | | | |

## V10.2 悪意あるコード検索

悪意のあるコードは極めてまれであり、検出が困難です。手動で詳細にコードレビューすることで論理爆弾を検出する手助けができますが、非常に経験豊富なコードレビュー担当者でさえ、悪意のあるコードが存在することを知っていても見つけるのに苦労します。

このセクションに従うことは、サードパーティライブラリを含む、ソースコードへの完全なアクセスなしでは不可能です。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.2.1** | アプリケーションソースコードおよびサードパーティライブラリに不正な phone home やデータ収集機能が含まれていない。そのような機能が存在する場合、データを収集する前に、その機能操作に対するユーザの許可を得る。 | | ✓ | ✓ | 359 |
| **10.2.2** | [8.3.11 へ移動] | | | | |
| **10.2.3** | アプリケーションソースコードおよびサードパーティライブラリに、ハードコードされたアカウントや鍵、追加の文書化されていないアカウントや鍵、文書化されていないバイナリ BLOB、ルートキット、デバッグ防御、セキュアではないデバッグ機能、その他の発見された場合に悪意を持って使用される可能性のある古い機能、セキュアではない機能、隠し機能などのバックドアがない。 | | | ✓ | 507 |
| **10.2.4** | 日付と時刻に関連する関数を検索して、アプリケーションソースおよびサードパーティライブラリに時限爆弾が含まれていない。 | | | ✓ | 511 |
| **10.2.5** | アプリケーションソースコードおよびサードパーティライブラリに、サラミ攻撃、ロジックバイパス、論理爆弾などの悪意のあるコードが含まれていない。 | | | ✓ | 511 |
| **10.2.6** | アプリケーションソースコードおよびサードパーティライブラリにイースターエッグやその他の望ましくない機能が含まれていない。 | | | ✓ | 507 |

## V10.3 アプリケーションの完全性

アプリケーションがデプロイされた後も、悪意のあるコードが挿入される可能性があります。アプリケーションは、信頼されていないソースから署名されていないコードの実行やサブドメインのテイクオーバーなどの一般的な攻撃から自分自身を保護する必要があります。

このセクションに従うことは戦略的かつ継続的であることが望まれます。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.3.1** | アプリケーションにクライアントまたはサーバの自動更新機能がある場合、更新はセキュアなチャネル経由で取得し、デジタル署名されている。更新コードは更新をインストールまたは実行する前に、その更新のデジタル署名を確認する必要がある。 | ✓ | ✓ | ✓ | 16 |
| **10.3.2** | [修正] アプリケーションがコード署名などの完全性保護を採用している場合にのみ、アプリケーションの直接の制御または保護下にないソースからのコード、モジュール、コンテンツ、プラグインをロードまたは実行している。 | ✓ | ✓ | ✓ | 829 |
| **10.3.3** | [削除, スコープ外] | | | | |

## V10.4 防御的コーディング

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.4.1** | [追加] アプリケーションは変数が正しい型であることを明示的に保証し、厳密な等価演算と比較演算を実行して、アプリケーションコードが変数の型について仮定することによって引き起こされる型ジャグリングや型コンフュージョンの脆弱性を回避している。 | ✓ | ✓ | ✓ | 843 |
| **10.4.2** | [追加] アプリケーションは、明示的な変数宣言の採用、厳密な型チェックの実行、document オブジェクトへのグローバル変数の保存の回避、名前空間分離の実装によって、クライアントサイド JavaScript を使用する際の DOM clobbering を回避している。 | | ✓ | ✓ | 79 |
| **10.4.3** | [追加] JavaScript コードはオブジェクトリテラルの代わりに Set() や Map() を使用するなど、プロトタイプ汚染を防ぐ方法で記述している。 | | ✓ | ✓ | |
| **10.4.4** | [修正, 5.1.2 から移動] アプリケーションには、コントローラやアクションごとに許可されるフィールドを制限することで、大量割り当て攻撃から保護する対策がある。たとえば、そのアクションの一部となることを意図していないフィールド値を挿入または更新することはできない。 | ✓ | ✓ | ✓ | 915 |

## 参考情報

詳しくは以下の情報を参照してください。

* [Reference on Protecting against DOM Clobbering](https://domclob.xyz/domc_wiki/indicators/patterns.html#secure-patterns--guidelines)
* [OWASP Prototype Pollution Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Prototype_Pollution_Prevention_Cheat_Sheet.html)
* [OWASP Mass Assignment Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html)

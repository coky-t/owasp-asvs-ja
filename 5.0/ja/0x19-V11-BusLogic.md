# V11 ビジネスロジック

## 管理目標

検証対象のアプリケーションが以下の上位要件を満たすことを確認します。

* ビジネスロジックフローはシーケンシャルであり、順番に処理され、迂回できません。
* ビジネスロジックには継続的な小額の資金転送や一度に百万の友人の追加の自動攻撃を検出および防御するための制限とコントロールを含んでいます。
* 高価値のビジネスロジックフローでは悪用ケースや悪意のある人物を考慮し、なりすまし、改竄、情報漏洩、権限昇格の攻撃に対する保護を有しています。

## V11.1 ビジネスロジックセキュリティ

ビジネスロジックセキュリティはすべてのアプリケーションにはそれぞれ個性があるため、一つのチェックリストをすべてに適用することはできません。ビジネスロジックセキュリティは外部からの脅威に対して保護するようにシステム内に設計されている必要があります。Web アプリケーションファイアウォールやセキュア通信を使用して追加することはできません。OWASP Cornucopia や同様のツールを使用するなどして、デザインスプリントの中で脅威モデリングを使用することをお勧めします。

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **11.1.1** | アプリケーションは同じユーザのビジネスロジックフローをシーケンシャルなステップ順序でのみ処理し、ステップをスキップしない。 | ✓ | ✓ | ✓ | 841 |
| **11.1.2** | [11.2.1 へ移動] | | | | |
| **11.1.3** | [修正] アプリケーションは特定のビジネスアクションやトランザクションに対してユーザごとに定義された適切な制限がある。 | ✓ | ✓ | ✓ | |
| **11.1.4** | [11.2.2 へ移動] | | | | |
| **11.1.5** | [修正] アプリケーションは、脅威モデリングや同様の方法論を用いて特定された、起こりうるビジネスリスクや脅威から保護するために、グローバルに定義されたビジネスロジック制限やバリデーションがある。 | ✓ | ✓ | ✓ | |
| **11.1.6** | [修正] アプリケーションは内部データの一貫性を保ち、ユーザーの状態を維持し、'time of check to time of use (TOCTOU)' 脆弱性などの競合状態を防ぐために、機密性の高い操作に対して同期およびロックのメカニズムを使用する。 | | ✓ | ✓ | 367 |
| **11.1.7** | アプリケーションはビジネスロジックの観点から異常なイベントやアクティビティを監視している。例えば、順序の異なるアクションや通常のユーザが決して行わないアクションを実行しようと試みる。 ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 754 |
| **11.1.8** | アプリケーションは自動化された攻撃や異常なアクティビティが検出されたときに設定可能なアラートを発している。 | | ✓ | ✓ | 390 |
| **11.1.9** | [追加] "アトミックトランザクション" はビジネスロジックレベルで使用されてビジネスロジックオペレーション全体が成功するか、以前の正しい状態にロールバックされる。 | | ✓ | ✓ | |

## V11.2 アンチオートメーション

| # | 説明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **11.2.1** | [11.1.2 から移動] アプリケーションはすべてのステップで現実的な人的時間、すなわちトランザクションがあまりに速く送信されていない、で処理されたビジネスロジックフローのみを処理する。 | ✓ | ✓ | ✓ | 799 |
| **11.2.2** | [修正, 11.1.4 から移動] アプリケーションは大量のデータ流出、ジャンクデータ作成、リソースクォータの枯渇、レート制限違反、帯域外通信のフラッディング、サービス拒否、高価なリソースの過剰使用などを引き起こす可能性のあるアプリケーション機能への過度の呼び出しから保護するための自動化防止コントロールがある。 | ✓ | ✓ | ✓ | 770 |

## 参考情報

詳しくは以下の情報を参照してください。

* [OWASP Web Security Testing Guide 4.1: Business Logic Testing](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/10-Business_Logic_Testing/README.html)
* [OWASP AppSensor](https://github.com/jtmelton/appsensor) や [OWASP Automated Threats to Web Applications](https://owasp.org/www-project-automated-threats-to-web-applications/) の使用を含め、自動化対策はさまざまな方法で実現できます。
* [OWASP AppSensor](https://github.com/jtmelton/appsensor) は攻撃検出と対応にも役立ちます。
* [OWASP Cornucopia](https://owasp.org/www-project-cornucopia/)
